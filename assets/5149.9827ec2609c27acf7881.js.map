{"version":3,"file":"assets/5149.9827ec2609c27acf7881.js","mappings":"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","sources":["webpack://@basthon/basthon-notebook/./node_modules/@basthon/kernel-base/lib/version.js","webpack://@basthon/basthon-notebook/./node_modules/@basthon/kernel-base/lib/kernel.js","webpack://@basthon/basthon-notebook/./node_modules/@basthon/kernel-python3/lib/kernel.js"],"sourcesContent":["export const VERSION = \"0.62.21\";\n","import { PromiseDelegate } from \"promise-delegate\";\nimport { VERSION } from \"./version\";\nconst _localfsScheme = \"filesystem:/\";\n/* we mock the fetch function to redirect queries to local FS */\n(function () {\n    var _a;\n    const toDataURL = async (content) => {\n        return await new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onloadend = () => {\n                resolve(reader.result);\n            };\n            reader.onerror = reject;\n            reader.readAsDataURL(new Blob([content]));\n        });\n    };\n    //@ts-ignore\n    window._fetch = (_a = window._fetch) !== null && _a !== void 0 ? _a : window.fetch;\n    window.fetch = async function (request, opts) {\n        var _a;\n        //@ts-ignore\n        const url = (_a = request.url) !== null && _a !== void 0 ? _a : request.toString();\n        const prefix = _localfsScheme;\n        if (url.startsWith(prefix)) {\n            const path = url.slice(prefix.length);\n            let content = null;\n            const options = {\n                status: 200,\n                statusText: \"OK\",\n                headers: new Headers(),\n            };\n            try {\n                //@ts-ignore\n                content = window.Basthon.getFile(path);\n                const dataURL = await toDataURL(content);\n                const mime = dataURL.substring(dataURL.indexOf(\":\") + 1, dataURL.indexOf(\";\"));\n                content = content.buffer;\n                options.headers.append(\"Content-Type\", mime);\n                options.headers.append(\"Content-Length\", content.byteLength);\n            }\n            catch (e) {\n                options.status = 404;\n                options.statusText = \"Not Found\";\n            }\n            return new Response(content, options);\n        }\n        //@ts-ignore\n        return await window._fetch(request, opts);\n    };\n    const desc = Object.getOwnPropertyDescriptor(HTMLImageElement.prototype, \"src\");\n    Object.defineProperty(HTMLImageElement.prototype, \"src\", {\n        ...desc,\n        get: function () {\n            var _a;\n            return (_a = desc === null || desc === void 0 ? void 0 : desc.get) === null || _a === void 0 ? void 0 : _a.call(this);\n        },\n        set: function (e) {\n            var _a;\n            const prefix = _localfsScheme;\n            if (e.startsWith(prefix)) {\n                const path = e.slice(prefix.length);\n                //@ts-ignore\n                const content = window.Basthon.getFile(path).buffer;\n                (async () => { var _a; return (_a = desc === null || desc === void 0 ? void 0 : desc.set) === null || _a === void 0 ? void 0 : _a.call(this, await toDataURL(content)); })();\n            }\n            else {\n                (_a = desc === null || desc === void 0 ? void 0 : desc.set) === null || _a === void 0 ? void 0 : _a.call(this, e);\n            }\n        },\n    });\n})();\n/**\n * An error thrown by not implemented API functions.\n */\nclass NotImplementedError extends Error {\n    constructor(funcName) {\n        super(`Function ${funcName} not implemented!`);\n        this.name = \"NotImplementedError\";\n    }\n}\n/**\n * Event for Basthon's dispatch/listen.\n */\nclass BasthonEvent extends Event {\n    constructor(id, data) {\n        super(id);\n        this.detail = data;\n    }\n}\n/**\n * API that any Basthon kernel should fill to be supported\n * in console/notebook.\n */\nexport class KernelBase {\n    constructor(options) {\n        this._ready = false;\n        this._loaded = new PromiseDelegate();\n        this._execution_count = 0;\n        this._pendingInput = false;\n        // a map to register wrapped listeners to allow later remove\n        this._listeners = new Map();\n        // root path where kernel is installed\n        this._rootPath = options.rootPath;\n    }\n    /**\n     * Kernel version number (string).\n     */\n    version() {\n        return VERSION;\n    }\n    /**\n     * Language implemented in the kernel (string).\n     * Generally lower case.\n     */\n    language() {\n        throw new NotImplementedError(\"language\");\n    }\n    /**\n     * Language name implemented in the kernel (string).\n     * As it should be displayed in text.\n     */\n    languageName() {\n        throw new NotImplementedError(\"languageName\");\n    }\n    /**\n     * Script (module) file extensions\n     */\n    moduleExts() {\n        throw new NotImplementedError(\"moduleExts\");\n    }\n    /**\n     * Launch the kernel.\n     */\n    async launch() {\n        throw new NotImplementedError(\"launch\");\n    }\n    /**\n     * Execution count getter.\n     */\n    get execution_count() {\n        return this._execution_count;\n    }\n    /**\n     * Async code evaluation that resolves with the result.\n     */\n    evalAsync(code, outCallback, errCallback, data = null) {\n        throw new NotImplementedError(\"evalAsync\");\n    }\n    restart() {\n        throw new NotImplementedError(\"restart\");\n    }\n    async putFile(filename, content) {\n        throw new NotImplementedError(\"putFile\");\n    }\n    async putModule(filename, content) {\n        throw new NotImplementedError(\"putModule\");\n    }\n    userModules() {\n        return [];\n    }\n    /**\n     * Get a file content from the VFS.\n     */\n    getFile(path) {\n        throw new NotImplementedError(\"getFile\");\n    }\n    /**\n     * Get a user module file content.\n     */\n    getUserModuleFile(filename) {\n        throw new NotImplementedError(\"getUserModuleFile\");\n    }\n    more(source) {\n        throw new NotImplementedError(\"more\");\n    }\n    complete(code) {\n        return [];\n    }\n    banner() {\n        return `Welcome to the ${this.languageName()} REPL!`;\n    }\n    ps1() {\n        return \">>> \";\n    }\n    ps2() {\n        return \"... \";\n    }\n    /**\n     * Initialize the kernel.\n     */\n    async init() {\n        try {\n            await this.launch();\n        }\n        catch (error) {\n            this._loaded.reject(error);\n            return;\n        }\n        // connecting eval to basthon.eval.request event.\n        this.addEventListener(\"eval.request\", this.evalFromEvent.bind(this));\n        this._ready = true;\n        this._loaded.resolve();\n    }\n    /**\n     * Is the kernel ready?\n     */\n    get ready() {\n        return this._ready;\n    }\n    /**\n     * Promise that resolve when the kernel is loaded.\n     */\n    async loaded() {\n        await this._loaded.promise;\n    }\n    /**\n     * Root for kernel files. This is always the language directory\n     * inside the version number directory inside the kernel directory.\n     */\n    basthonRoot(absolute = false) {\n        let url = this._rootPath + \"/\" + this.version() + \"/\" + this.language();\n        if (absolute && !url.startsWith(\"http\")) {\n            const base = window.location.origin + window.location.pathname;\n            url = base.substring(0, base.lastIndexOf(\"/\")) + \"/\" + url;\n        }\n        return url;\n    }\n    /**\n     * Downloading data (bytes array or data URL) as filename\n     * (opening browser dialog).\n     */\n    download(data, filename) {\n        if (!(typeof data === \"string\" || data instanceof String)) {\n            const blob = new Blob([data], { type: \"application/octet-stream\" });\n            data = window.URL.createObjectURL(blob);\n        }\n        const anchor = document.createElement(\"a\");\n        anchor.download = filename;\n        anchor.href = data;\n        anchor.target = \"_blank\";\n        anchor.style.display = \"none\"; // just to be safe!\n        document.body.appendChild(anchor);\n        anchor.click();\n        document.body.removeChild(anchor);\n    }\n    /**\n     * Dynamically load a script asynchronously.\n     */\n    static loadScript(url) {\n        return new Promise(function (resolve, reject) {\n            let script = document.createElement(\"script\");\n            script.onload = resolve;\n            script.onerror = reject;\n            script.src = url;\n            document.head.appendChild(script);\n        });\n    }\n    /**\n     * Wrapper around document.dispatchEvent.\n     * It adds the 'basthon.' prefix to each event name and\n     * manage the event lookup to retreive relevent data.\n     */\n    dispatchEvent(eventName, data) {\n        document.dispatchEvent(new BasthonEvent(`basthon.${eventName}`, data));\n    }\n    /**\n     * Wrapper around document.addEventListener.\n     * It manages the 'basthon.' prefix to each event name and\n     * manage the event lookup to retreive relevent data.\n     */\n    addEventListener(eventName, callback) {\n        // wrapped callback\n        const _callback = (event) => callback(event.detail);\n        document.addEventListener(`basthon.${eventName}`, _callback);\n        // register the wrapped callback in order to remove it\n        let listeners = this._listeners.get(eventName);\n        if (listeners == null) {\n            listeners = new Map();\n            this._listeners.set(eventName, listeners);\n        }\n        listeners.set(callback, _callback);\n    }\n    /**\n     * Wrapper around document.removeEventListener.\n     * It manages the 'basthon.' prefix to each event name.\n     */\n    removeEventListener(eventName, callback) {\n        // get the wrapped callback\n        const listeners = this._listeners.get(eventName);\n        document.removeEventListener(`basthon.${eventName}`, listeners === null || listeners === void 0 ? void 0 : listeners.get(callback));\n    }\n    /**\n     * Send eval.input event then wait for the user response and return it.\n     */\n    async inputAsync(prompt, password = false, data = undefined) {\n        data = this.clone(data);\n        data.content = { prompt, password };\n        const promise = new Promise(function (resolve, reject) {\n            data.resolve = resolve;\n            data.reject = reject;\n        });\n        this._pendingInput = true;\n        this.dispatchEvent(\"eval.input\", data);\n        const res = await promise;\n        this._pendingInput = false;\n        return res;\n    }\n    /**\n     * Simple clone via JSON copy.\n     */\n    clone(obj) {\n        // simple trick that is enough for our purpose.\n        return JSON.parse(JSON.stringify(obj));\n    }\n    /**\n     * Put a ressource (file or module).\n     * Detection is based on extension.\n     */\n    async putRessource(filename, content) {\n        var _a;\n        const ext = (_a = filename.split(\".\").pop()) !== null && _a !== void 0 ? _a : \"\";\n        if (this.moduleExts().includes(ext)) {\n            return await this.putModule(filename, content);\n        }\n        else {\n            return await this.putFile(filename, content);\n        }\n    }\n    /**\n     * Is an input pending?\n     */\n    pendingInput() {\n        return this._pendingInput;\n    }\n    /**\n     * Internal. Code evaluation after an eval.request event.\n     */\n    async evalFromEvent(data) {\n        const stdCallback = (std) => (text) => {\n            let dataEvent = this.clone(data);\n            dataEvent.stream = std;\n            dataEvent.content = text;\n            this.dispatchEvent(\"eval.output\", dataEvent);\n        };\n        const outCallback = stdCallback(\"stdout\");\n        const errCallback = stdCallback(\"stderr\");\n        let args;\n        try {\n            args = await this.evalAsync(data.code, outCallback, errCallback, data);\n        }\n        catch (error) {\n            errCallback(error.toString());\n            const dataEvent = this.clone(data);\n            dataEvent.error = error;\n            dataEvent.execution_count = this.execution_count;\n            this.dispatchEvent(\"eval.error\", dataEvent);\n            return;\n        }\n        if (args == null)\n            return; // this should not happend\n        const result = args[0];\n        const executionCount = args[1];\n        let dataEvent = this.clone(data);\n        dataEvent.execution_count = executionCount;\n        if (result != null)\n            dataEvent.result = result;\n        this.dispatchEvent(\"eval.finished\", dataEvent);\n    }\n}\n","import { KernelBase } from \"@basthon/kernel-base\";\nconst PYODIDE_VERSION = \"0.23.2\";\n/**\n * A Python kernel that satisfies Basthon's API.\n */\nexport class KernelPython3 extends KernelBase {\n    constructor(options) {\n        var _a;\n        super(options);\n        /**\n         * Where to find pyodide.js (private).\n         */\n        this._pyodideURLs = [\n            `https://cdn.jsdelivr.net/pyodide/v{PYODIDE_VERSION}/full/pyodide.js`,\n        ];\n        this.__kernel__ = null;\n        this.pythonVersion = \"\";\n        // for locally installed Pyodide\n        this._pyodideURLs.unshift(`${this.basthonRoot()}/pyodide/pyodide.js`);\n        this._pyodideURLs = (_a = options === null || options === void 0 ? void 0 : options.pyodideURLs) !== null && _a !== void 0 ? _a : this._pyodideURLs;\n    }\n    /**\n     * Get the URL of Basthon modules dir.\n     */\n    basthonModulesRoot(absolute = false) {\n        return this.basthonRoot(absolute) + \"/modules\";\n    }\n    language() {\n        return \"python3\";\n    }\n    languageName() {\n        return \"Python 3\";\n    }\n    moduleExts() {\n        return [\"py\"];\n    }\n    /**\n     * What to do when loaded (private).\n     */\n    async _onload() {\n        const pyodide = window.pyodide;\n        // reformat repodata\n        const packages = pyodide._api.repodata_packages;\n        for (let p of Object.keys(packages)) {\n            const item = packages[p];\n            item.file_name = item.file_name.replace(\"{basthonRoot}\", this.basthonRoot(true));\n        }\n        // get the version of Python from Python\n        this.pythonVersion = pyodide.runPython(\"import platform ; platform.python_version()\");\n        // load basthon and get kernel\n        await pyodide.loadPackage(\"basthon\");\n        this.__kernel__ = pyodide.pyimport(\"basthon\").__kernel__;\n    }\n    /**\n     * Start the Basthon kernel asynchronously.\n     */\n    async launch() {\n        let pyodideURL = this._pyodideURLs[0];\n        for (let url of this._pyodideURLs) {\n            url = url.replace(\"{PYODIDE_VERSION}\", PYODIDE_VERSION);\n            try {\n                const response = await fetch(url, { method: \"HEAD\" });\n                if (response.ok) {\n                    pyodideURL = url;\n                    break;\n                }\n            }\n            catch (e) { }\n        }\n        try {\n            await KernelPython3.loadScript(pyodideURL);\n        }\n        catch (error) {\n            console.log(error);\n            console.error(\"Can't load pyodide.js\");\n            throw error;\n        }\n        if (window.loadPyodide == null) {\n            console.log(\"window.loadPyodide is null!\");\n            throw new Error(\"Can't load pyodide.js\");\n        }\n        try {\n            // loading with custom repodata.json\n            window.pyodide = await window.loadPyodide({\n                lockFileURL: this.basthonRoot() + \"/repodata.json\",\n            });\n        }\n        catch (error) {\n            console.log(error);\n            console.error(\"Can't load Python from Pyodide\");\n            throw error;\n        }\n        await this._onload();\n    }\n    /**\n     * Execution count getter overload.\n     */\n    get execution_count() {\n        return this.__kernel__.execution_count();\n    }\n    /**\n     * Basthon async code evaluation function.\n     */\n    async evalAsync(code, outCallback, errCallback, data = null) {\n        if (typeof outCallback === \"undefined\") {\n            outCallback = function (text) {\n                console.log(text);\n            };\n        }\n        if (typeof errCallback === \"undefined\") {\n            errCallback = function (text) {\n                console.error(text);\n            };\n        }\n        // dependencies are loaded by eval\n        const proxy = await this.__kernel__.eval(code, outCallback, errCallback, data);\n        // when an error occures, proxy should be the error message\n        if (!(proxy instanceof window.pyodide.ffi.PyProxy))\n            throw proxy;\n        const res = proxy.toJs({\n            create_proxies: false,\n            dict_converter: Object.fromEntries,\n        });\n        proxy.destroy();\n        return res;\n    }\n    /**\n     * Restart the kernel.\n     */\n    restart() {\n        return this.__kernel__.restart();\n    }\n    /**\n     * Put a file on the local (emulated) filesystem.\n     */\n    async putFile(filename, content) {\n        this.__kernel__.put_file(filename, content);\n    }\n    /**\n     * Put an importable module on the local (emulated) filesystem\n     * and load dependencies.\n     */\n    async putModule(filename, content) {\n        return await this.__kernel__.put_module(filename, content);\n    }\n    /**\n     * List modules launched via putModule.\n     */\n    userModules() {\n        const proxy = this.__kernel__.user_modules();\n        if (!(proxy instanceof window.pyodide.ffi.PyProxy))\n            return proxy;\n        const res = proxy.toJs();\n        proxy.destroy();\n        return res;\n    }\n    /**\n     * Get a file content from the VFS.\n     */\n    getFile(path) {\n        return this.__kernel__.get_file(path).toJs();\n    }\n    /**\n     * Get a user module file content.\n     */\n    getUserModuleFile(filename) {\n        return this.__kernel__.get_user_module_file(filename).toJs();\n    }\n    /**\n     * Is the source ready to be evaluated or want we more?\n     * Usefull to set ps1/ps2 for teminal prompt.\n     */\n    more(source) {\n        return this.__kernel__.more(source);\n    }\n    /**\n     * Mimic the CPython's REPL banner.\n     */\n    banner() {\n        /* We don't return this.__kernel__.banner();\n         * since the banner should be available ASAP.\n         * In tests, we check this.banner() ===  this.__kernel__.banner().\n         */\n        return `Python 3.11.2 (main, May  3 2023 04:00:05) on WebAssembly/Emscripten\\nType \\\"help\\\", \\\"copyright\\\", \\\"credits\\\" or \\\"license\\\" for more information.`;\n    }\n    /**\n     * Complete a code at the end (usefull for tab completion).\n     *\n     * Returns an array of two elements: the list of completions\n     * and the start index.\n     */\n    complete(code) {\n        const proxy = this.__kernel__.complete(code);\n        if (!(proxy instanceof window.pyodide.ffi.PyProxy))\n            return proxy;\n        const res = proxy.toJs();\n        proxy.destroy();\n        return res;\n    }\n    /**\n     * Change current directory (Python's virtual FS).\n     */\n    chdir(path) {\n        window.pyodide._module.FS.chdir(path);\n    }\n    /**\n     * Create directory (Python's virtual FS).\n     */\n    mkdir(path) {\n        window.pyodide._module.FS.mkdir(path);\n    }\n}\n"],"names":["_localfsScheme","_a","toDataURL","async","content","Promise","resolve","reject","reader","FileReader","onloadend","result","onerror","readAsDataURL","Blob","window","_fetch","fetch","request","opts","url","toString","prefix","startsWith","path","slice","options","status","statusText","headers","Headers","Basthon","getFile","dataURL","mime","substring","indexOf","buffer","append","byteLength","e","Response","desc","Object","getOwnPropertyDescriptor","HTMLImageElement","prototype","defineProperty","get","call","this","set","NotImplementedError","Error","constructor","funcName","super","name","BasthonEvent","Event","id","data","detail","KernelBase","_ready","_loaded","PromiseDelegate","_execution_count","_pendingInput","_listeners","Map","_rootPath","rootPath","version","language","languageName","moduleExts","execution_count","evalAsync","code","outCallback","errCallback","restart","filename","userModules","getUserModuleFile","more","source","complete","banner","ps1","ps2","launch","error","addEventListener","evalFromEvent","bind","ready","promise","basthonRoot","absolute","base","location","origin","pathname","lastIndexOf","download","String","blob","type","URL","createObjectURL","anchor","document","createElement","href","target","style","display","body","appendChild","click","removeChild","static","script","onload","src","head","dispatchEvent","eventName","callback","_callback","event","listeners","removeEventListener","prompt","password","undefined","clone","res","obj","JSON","parse","stringify","ext","split","pop","includes","putModule","putFile","pendingInput","stdCallback","std","text","dataEvent","stream","args","executionCount","KernelPython3","_pyodideURLs","__kernel__","pythonVersion","unshift","pyodideURLs","basthonModulesRoot","pyodide","packages","_api","repodata_packages","p","keys","item","file_name","replace","runPython","loadPackage","pyimport","pyodideURL","method","ok","loadScript","console","log","loadPyodide","lockFileURL","_onload","proxy","eval","ffi","PyProxy","toJs","create_proxies","dict_converter","fromEntries","destroy","put_file","put_module","user_modules","get_file","get_user_module_file","chdir","_module","FS","mkdir"],"sourceRoot":""}